---
title: "Blog Post 2 Code"
author: "Vivian Nguyen"
date: '2022-09-17'
output: pdf_document
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p><img src="/post/2022-09-19-local-and-national-economy/BP2_Code_files/figure-html/unnamed-chunk-2-1.png" width="60%" style="display: block; margin: auto;" /><img src="/post/2022-09-19-local-and-national-economy/BP2_Code_files/figure-html/unnamed-chunk-2-2.png" width="60%" style="display: block; margin: auto;" /><img src="/post/2022-09-19-local-and-national-economy/BP2_Code_files/figure-html/unnamed-chunk-2-3.png" width="60%" style="display: block; margin: auto;" /></p>
<div id="bivariate-correlation-of-gdp-and-pv" class="section level2">
<h2>Bivariate correlation of GDP / and PV</h2>
<pre class="r"><code>## Finding correlations

# cpi &lt;- read_csv(&quot;CPI_monthly.csv&quot;)

cor(results_GDP$GDP_growth_pct, results_GDP$H_incumbent_party_majorvote_pct)
cor(results_RDI$DSPIC_change_pct, results_RDI$H_incumbent_party_majorvote_pct)
cor(results_UE$UNRATE, results_UE$H_incumbent_party_majorvote_pct)</code></pre>
</div>
<div id="economy-and-pv-fitting-a-model-step-1-2" class="section level2 build">
<h2>Economy and PV: Fitting a model (STEP 1 &amp; 2)</h2>
<pre class="r"><code>newdf &lt;- left_join(results_UE, results_GDP, by = &#39;year&#39;)
newdf &lt;-left_join (newdf, results_RDI, by = &#39;year&#39;) %&gt;%
  select(&#39;year&#39;, &#39;winner_party.x&#39;, &#39;H_incumbent_party.x&#39;, &#39;H_incumbent_party_majorvote_pct.x&#39;, &#39;quarter_cycle.x&#39;, &#39;UNRATE&#39;, &#39;GDP_growth_pct&#39;, &#39;DSPIC_change_pct&#39;, &#39;unrate_qt_total&#39;, &#39;DSPIC_change_qt&#39;, &#39;GDP_growth_qt&#39;, &#39;UNRATE_change&#39;) %&gt;%
  rename(&#39;winner_party&#39; = &#39;winner_party.x&#39;, &#39;H_incumbent_party_majorvote_pct&#39; = &#39;H_incumbent_party_majorvote_pct.x&#39;, &#39;quarter_cycle&#39; = &#39;quarter_cycle.x&#39;, &#39;H_incumbent_party&#39; = &#39;H_incumbent_party.x&#39;)

newdf</code></pre>
<pre><code>## # A tibble: 37 × 12
##     year winner_party H_incumbent_party H_incumbent_party_… quarter_cycle UNRATE
##    &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;                           &lt;dbl&gt;         &lt;dbl&gt;  &lt;dbl&gt;
##  1  1948 D            R                                46.6             4    3.7
##  2  1950 R            D                                49.7             4    4.2
##  3  1952 D            R                                48.8             4    3  
##  4  1954 D            D                                52.4             4    5.7
##  5  1956 D            D                                51.2             4    3.9
##  6  1958 D            D                                55.0             4    6.7
##  7  1960 D            D                                54.4             4    6.1
##  8  1962 D            D                                52.9             4    5.4
##  9  1964 D            D                                57.3             4    5.1
## 10  1966 D            D                                50.9             4    3.7
## # … with 27 more rows, and 6 more variables: GDP_growth_pct &lt;dbl&gt;,
## #   DSPIC_change_pct &lt;dbl&gt;, unrate_qt_total &lt;dbl&gt;, DSPIC_change_qt &lt;dbl&gt;,
## #   GDP_growth_qt &lt;dbl&gt;, UNRATE_change &lt;dbl&gt;</code></pre>
<pre class="r"><code>lm_GDP &lt;- lm(H_incumbent_party_majorvote_pct ~ GDP_growth_pct, data = newdf)
lm_RDI &lt;- lm(H_incumbent_party_majorvote_pct ~ DSPIC_change_pct, data = newdf)
lm_UE &lt;- lm(H_incumbent_party_majorvote_pct ~ UNRATE, data = newdf)
lm_model &lt;- lm(H_incumbent_party_majorvote_pct ~ GDP_growth_pct + DSPIC_change_pct + GDP_growth_qt + UNRATE, data = newdf)
stargazer(lm_GDP, lm_RDI, lm_UE, lm_model, title = &quot;Results&quot;, type = &quot;text&quot;)</code></pre>
<pre><code>## 
## Results
## ====================================================================================================
##                                                   Dependent variable:                               
##                     --------------------------------------------------------------------------------
##                                             H_incumbent_party_majorvote_pct                         
##                             (1)                (2)                 (3)                  (4)         
## ----------------------------------------------------------------------------------------------------
## GDP_growth_pct            -0.912*                                                      2.903*       
##                           (0.520)                                                     (1.565)       
##                                                                                                     
## DSPIC_change_pct                              -0.796                                  -1.577**      
##                                              (0.609)                                  (0.675)       
##                                                                                                     
## GDP_growth_qt                                                                        -0.036***      
##                                                                                       (0.013)       
##                                                                                                     
## UNRATE                                                           0.747**               0.420        
##                                                                  (0.325)              (0.337)       
##                                                                                                     
## Constant                 52.424***          52.578***           47.480***            51.179***      
##                           (0.656)            (0.760)             (1.940)              (2.205)       
##                                                                                                     
## ----------------------------------------------------------------------------------------------------
## Observations                37                  31                  37                   31         
## R2                         0.081              0.056               0.131                0.386        
## Adjusted R2                0.054              0.023               0.106                0.292        
## Residual Std. Error   3.270 (df = 35)    3.400 (df = 29)     3.180 (df = 35)      2.895 (df = 26)   
## F Statistic         3.071* (df = 1; 35) 1.713 (df = 1; 29) 5.263** (df = 1; 35) 4.094** (df = 4; 26)
## ====================================================================================================
## Note:                                                                    *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
<div id="economy-and-pv-fitting-a-model-step-1-2-1" class="section level2">
<h2>Economy and PV: Fitting a model (STEP 1 &amp; 2)</h2>
<p><img src="/post/2022-09-19-local-and-national-economy/BP2_Code_files/figure-html/unnamed-chunk-6-1.png" width="100%" style="display: block; margin: auto;" /></p>
<pre><code>##                  Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept)    52.4238447  0.6556942 79.951665 3.225920e-41
## GDP_growth_pct -0.9118204  0.5202833 -1.752546 8.843719e-02</code></pre>
<pre><code>##                    Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept)      52.5781452  0.7596862 69.210344 9.333092e-34
## DSPIC_change_pct -0.7963923  0.6085193 -1.308738 2.009001e-01</code></pre>
<pre><code>##               Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 47.4800112  1.9399759 24.474536 1.327535e-23
## UNRATE       0.7466082  0.3254423  2.294134 2.789902e-02</code></pre>
<pre><code>## Warning: Removed 6 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 6 rows containing missing values (geom_text).</code></pre>
<p><img src="/post/2022-09-19-local-and-national-economy/BP2_Code_files/figure-html/unnamed-chunk-6-2.png" width="100%" style="display: block; margin: auto;" /><img src="/post/2022-09-19-local-and-national-economy/BP2_Code_files/figure-html/unnamed-chunk-6-3.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="how-to-evaluate-your-model-step-3" class="section level1">
<h1>How to evaluate your model (STEP 3)</h1>
<div id="model-fit-r2" class="section level2">
<h2>Model Fit: <span class="math inline">\(R^2\)</span></h2>
<pre class="r"><code>summary(lm_GDP)$r.squared</code></pre>
<pre><code>## [1] 0.08067517</code></pre>
<pre class="r"><code>summary(lm_RDI)$r.squared</code></pre>
<pre><code>## [1] 0.05576812</code></pre>
<pre class="r"><code>summary(lm_UE)$r.squared</code></pre>
<pre><code>## [1] 0.1307167</code></pre>
<pre class="r"><code>summary(lm_model)$r.squared</code></pre>
<pre><code>## [1] 0.386466</code></pre>
</div>
<div id="model-fit-in-sample-error-and-mse" class="section level2">
<h2>Model Fit: in-sample error and MSE</h2>
<pre class="r"><code># UE
plot(newdf$year, newdf$H_incumbent_party_majorvote_pct, 
     type=&quot;l&quot;,
     main=&quot;true Y (line), predicted Y (dot) for each year&quot;)
points(newdf$year, predict(lm_UE, newdf))</code></pre>
<p><img src="/post/2022-09-19-local-and-national-economy/BP2_Code_files/figure-html/unnamed-chunk-8-1.png" width="30%" style="display: block; margin: auto;" /></p>
<pre class="r"><code># My model
plot(newdf$year, newdf$H_incumbent_party_majorvote_pct, 
     type=&quot;l&quot;,
     main=&quot;true Y (line), predicted Y (dot) for each year&quot;)
points(newdf$year, predict(lm_model, newdf))</code></pre>
<p><img src="/post/2022-09-19-local-and-national-economy/BP2_Code_files/figure-html/unnamed-chunk-8-2.png" width="30%" style="display: block; margin: auto;" /></p>
</div>
<div id="model-fit-in-sample-error-and-mse-1" class="section level2">
<h2>Model Fit: in-sample error and MSE</h2>
<p>We can plot the in-sample error via , which capture the difference between each observed value (<span class="math inline">\(y_i\)</span>) and predicted value (<span class="math inline">\(\widehat{y}_i = \hat{A} + \widehat{B}x_i\)</span>):</p>
<pre class="r"><code># UE
hist(lm_UE$model$H_incumbent_party_majorvote_pct - lm_UE$fitted.values, 
     main=&quot;histogram of true Y - predicted Y&quot;)</code></pre>
<p><img src="/post/2022-09-19-local-and-national-economy/BP2_Code_files/figure-html/unnamed-chunk-9-1.png" width="70%" style="display: block; margin: auto;" /></p>
<pre class="r"><code># My model
hist(lm_model$model$H_incumbent_party_majorvote_pct - lm_model$fitted.values,
     main=&quot;histogram of true Y - predicted Y&quot;)</code></pre>
<p><img src="/post/2022-09-19-local-and-national-economy/BP2_Code_files/figure-html/unnamed-chunk-9-2.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="model-fit-in-sample-error-and-mse-2" class="section level2">
<h2>Model Fit: in-sample error and MSE</h2>
<p>We can summarise the error a single number, such as the :</p>
<pre class="r"><code># GDP
mse_UE &lt;- mean((lm_UE$model$H_incumbent_party_majorvote_pct - lm_UE$fitted.values)^2)
mse_GDP &lt;- mean((lm_GDP$model$H_incumbent_party_majorvote_pct - lm_GDP$fitted.values)^2)
mse_RDI &lt;- mean((lm_RDI$model$H_incumbent_party_majorvote_pct - lm_RDI$fitted.values)^2)
mse_model &lt;- mean((lm_model$model$H_incumbent_party_majorvote_pct - lm_model$fitted.values)^2)

sqrt(mse_UE)</code></pre>
<pre><code>## [1] 3.092707</code></pre>
<pre class="r"><code>sqrt(mse_GDP)</code></pre>
<pre><code>## [1] 3.180479</code></pre>
<pre class="r"><code>sqrt(mse_RDI)</code></pre>
<pre><code>## [1] 3.288667</code></pre>
<pre class="r"><code>sqrt(mse_model)</code></pre>
<pre><code>## [1] 2.65094</code></pre>
<p></p>
</div>
<div id="model-testing" class="section level2">
<h2>Model Testing</h2>
<p>Checking in-sample model predictions is a good baseline evaluation, but it feels a bit like “cheating” <span class="math inline">\(\rightsquigarrow\)</span> can we take away the model’s “answer key”? </p>
<!--the best test of a model's predictive score -- simulate out-of-sample 
    prediction and check performance against ground-truth; in-sample is sort of 
    easy because it's double dipping the data, this is a harder test!-->
<p>We can simulate (also called out-of-sample testing) by withholding some observation, e.g. <span class="math inline">\(X_{2018}\)</span>, before fitting: </p>
<pre class="r"><code># GDP
# outsamp_mod1 &lt;- lm(H_incumbent_party_majorvote_pct ~ GDP_growth_pct, 
#                     dat2[dat2$year != 2018,])
# outsamp_pred &lt;- predict(outsamp_mod1, 
#                         dat2[dat2$year == 2018,])
# outsamp_true &lt;- dat2$H_incumbent_party_majorvote_pct[dat2$year == 2018] </code></pre>
<p>and see how well the model predicts the true <span class="math inline">\(Y_{2018}\)</span> for the held-out observation <span class="math inline">\(X_{2018}\)</span>:</p>
<pre class="r"><code># outsamp_pred - outsamp_true</code></pre>
<p>Leaving a single observation out and testing the model against the ground truth is, you guessed it, called .</p>
</div>
<div id="model-testing-1" class="section level2">
<h2>Model Testing</h2>
<p>: withold a <em>random subset</em> of the sample, fit model on rest of sample, and evaluate predictive performance on the held-out observations. </p>
<!-- Me: predicts 2016 within 2 points..but ok 2016 was weird -->
<pre class="r"><code># GDP
# years_outsamp &lt;- sample(dat2$year, 8)
# mod &lt;- lm(H_incumbent_party_majorvote_pct ~ GDP_growth_pct,
#           dat2[!(dat2$year %in% years_outsamp),])
# outsamp_pred &lt;- predict(mod,
#                 newdata = dat2[dat2$year %in% 
#                                  years_outsamp,])</code></pre>
<pre class="r"><code># mean(outsamp_pred - dat2$H_incumbent_party_majorvote_pct[dat2$year 
#                                                          %in% years_outsamp])</code></pre>
<p></p>
</div>
<div id="model-testing-2" class="section level2">
<h2>Model Testing</h2>
<p>Cross-validation involves repeatedly evaluating performance against many randomly held-out “out-of-sample” datasets:</p>
<!-- we can do this many times and see how out-of-sample performance usually is -->
<pre class="r"><code># years_outsamp &lt;- sample(dat2$year, 8)
# outsamp_mod &lt;- lm(H_incumbent_party_majorvote_pct ~ 
#                     GDP_growth_pct,
#                   dat2[!(dat2$year %in% years_outsamp),])
# outsamp_pred &lt;- predict(outsamp_mod,
#                 newdata = dat2[dat2$year %in% years_outsamp,])
# outsamp_true &lt;- dat2$H_incumbent_party_majorvote_pct[dat2$year 
#                                                      %in% years_outsamp]
# mean(outsamp_pred - outsamp_true)</code></pre>
</div>
<div id="model-testing-3" class="section level2">
<h2>Model Testing</h2>
<p>Cross-validation involves repeatedly evaluating performance against many randomly held-out “out-of-sample” datasets:</p>
<pre class="r"><code># outsamp_errors &lt;- sapply(1:1000, function(i){
#     years_outsamp &lt;- sample(dat2$year, 8)
#   outsamp_mod &lt;- lm(H_incumbent_party_majorvote_pct ~ 
#                       GDP_growth_pct,
#                   dat2[!(dat2$year %in% years_outsamp),])
#   outsamp_pred &lt;- predict(outsamp_mod,
#                 newdata = dat2[dat2$year %in% years_outsamp,])
#   outsamp_true &lt;- dat2$H_incumbent_party_majorvote_pct[dat2$year 
#                                                        %in% years_outsamp]
#   mean(outsamp_pred - outsamp_true)
# })</code></pre>
</div>
<div id="model-testing-4" class="section level2">
<h2>Model Testing</h2>
</div>
<div id="economy-and-pv-out-of-sample-prediction-step-4-5" class="section level2">
<h2>Economy and PV: Out-of-sample prediction (STEP 4 &amp; 5)</h2>
<pre class="r"><code>GDP_new &lt;- GDPquarterly_df %&gt;%
    subset(year == 2020 &amp; quarter_cycle == 8) %&gt;%
    select(GDP_growth_pct)
UNRATE_new &lt;- UEquarterly_df %&gt;%
    subset(year == 2020 &amp; quarter_cycle == 4) %&gt;%
    select(UNRATE)
DSPIC_new &lt;- RDIquarterly_df %&gt;%
    subset(year == 2020 &amp; quarter_cycle == 8) %&gt;%
    select(DSPIC_change_pct)
GDP_qt_new &lt;- GDPquarterly_df %&gt;%
    subset(year == 2020 &amp; quarter_cycle == 8) %&gt;%
    select(GDP_growth_qt)

new_data &lt;- data.frame(GDP_new, DSPIC_new, GDP_qt_new, UNRATE_new)

predict(lm_model, new_data, interval=&quot;confidence&quot;)

#Interpretation: This means that, according to our model, a year with these traits, on average, has a (stopping distance ranging between 51.83 and 62.44 ft)46, 54) H incument vote share</code></pre>
</div>
</div>
